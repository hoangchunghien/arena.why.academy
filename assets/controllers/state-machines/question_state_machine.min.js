function QuestionStateMachine(e,t){var n=this;this.question=e;this.answer=null;this.timeout=3e4;this.timeStep=250;this.remainingTime=this.timeout+1e3;this.correct=false;this.eventListener=t;this.questionEndingTimer;this.questionFinishTimer;var r=function(){n.currentState=n.states["initializing"];n.currentState.run()};var i=function(e){return true};this._validateAnswer=function(e){return true};var s=function(){};this.states={initializing:{name:"initializing",events:{initialized:"answering"},run:function(){console.log(logInfo+"starting");n.eventListener.handleEventNotification({name:"question_initializing",data:{}});s();n.consumeEvent({name:"initialized",data:{}})}},answering:{name:"answering",events:{question_answer:"answered",question_timeout:"timeout"},run:function(){console.log(logInfo+"answering");n.eventListener.handleEventNotification({name:"question_answering",data:{}})}},answered:{name:"answered",events:{question_ending:"ending"},run:function(){console.log(logInfo+"answered");clearTimeout(n.runtimeout);n.eventListener.handleEventNotification({name:"question_answered",data:{}});n.consumeEvent({name:"question_ending",data:{}})}},timeout:{name:"timeout",events:{question_ending:"ending"},run:function(){n.eventListener.handleEventNotification({name:"question_timeout",data:{}});n.consumeEvent({name:"question_ending",data:{}})}},ending:{name:"ending",events:{question_finish:"finish"},run:function(){console.log(logInfo+"ending");console.log(n.answer);var e;if(n.answer==parseInt(n.question.answer[n.question.question.length%20])){n.correct=true;n.score=Math.floor(n.remainingTime/1e3);e=3500}else{n.score=0;n.correct=false;e=2e3}var t=n.timeout-n.remainingTime;n.questionEndingTimer=setTimeout(function(){n.eventListener.handleEventNotification({name:"question_ending",data:{answer:n.answer,correct:n.correct,score:n.score,correctAnswer:parseInt(n.question.answer[n.question.question.length%20])}})},1e3);n.questionFinishTimer=setTimeout(function(){n.consumeEvent({name:"question_finish",data:{}})},e);if(n.remainingTime>0){ApolloAnalytics.track("Answered Question",{Corrected:n.correct,"Spent Time":t})}else{ApolloAnalytics.track("Answered Question",{"Spent Time":-1})}}},finish:{name:"finish",events:{},run:function(){console.log(logInfo+"finish");n.eventListener.handleEventNotification({name:"question_finish",data:{}})}}};r();this.activeTimer=function(){console.log("run Active timer");var e={};e.remainingTime=n.remainingTime;n.eventListener.handleEventNotification({name:"question_time_changed",data:e});var t=function(){n.runtimeout=setTimeout(function(){n.remainingTime-=n.timeStep;var e={};e.remainingTime=n.remainingTime;n.eventListener.handleEventNotification({name:"question_time_changed",data:e});if(n.remainingTime<=0){n.consumeEvent({name:"question_timeout"});return}t()},n.timeStep)};t()}}var logInfo="QuestionStateMachine: ";var EVENTS={RESPONSE:{INITIALIZING:"question_initializing",ANSWERING:"question_answering",ANSWERED:"question_answered",TIMERCHANGED:"question_time_changed",TIMEOUT:"question_timeout",ENDING:"question_ending",FINISH:"question_finish",ERROR:"question_error"}};QuestionStateMachine.prototype.destroy=function(){clearTimeout(this.questionFinishTimer);clearTimeout(this.questionEndingTimer);clearTimeout(this.runtimeout)};QuestionStateMachine.prototype.consumeEvent=function(e){var t=this;var n=e.name;var r=e.data;var i=t.currentState.events[n];if(i&&n==="question_answer"&&t._validateAnswer(e.data)){console.log(logInfo+"answer from user: "+JSON.stringify(e.data));t.answer=r.answer;t.currentState=t.states[i];t.currentState.run()}else if(i&&n!=="question_answer"){console.log(logInfo+" change from '"+t.currentState.name+"' to '"+i+"'");t.currentState=t.states[i];t.currentState.run()}else{t.eventListener.handleEventNotification({name:EVENTS.RESPONSE.ERROR,data:{message:" event '"+n+"' not acceptable in '"+t.currentState.name+"' state",cause_by:"Not acceptable event"}})}};QuestionStateMachine.prototype.getAnswer=function(){return this.answer};QuestionStateMachine.prototype.getCurrentState=function(){return this.currentState};QuestionStateMachine.prototype.active=function(){console.log("active Timer");this.activeTimer()}